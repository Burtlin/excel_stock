# 股票數據處理系統 - 打包與部署指南

## 📦 打包成 EXE 執行檔（在有 Python 環境的電腦上操作）

### 步驟 1：安裝 PyInstaller
```powershell
pip install pyinstaller
```

### 步驟 2：執行打包
```powershell
pyinstaller stock_processor.spec
```

打包完成後，會在 `dist` 資料夾中產生 `股票數據處理器.exe`

### 步驟 3：準備發布檔案
將以下檔案複製到同一個資料夾：
- `股票數據處理器.exe`（從 dist 資料夾）
- `執行股票處理.bat`
- `target.xlsx`（你的 Excel 檔案）
- `data` 資料夾（如果有 stock_info.json）

---

## 💻 在沒有 Python 的電腦上使用

### 方法一：使用批次檔（最簡單）
1. 將 `target.xlsx` 與 `股票數據處理器.exe` 放在同一資料夾
2. 雙擊 `執行股票處理.bat`
3. 等待處理完成

### 方法二：在 Excel 中加入按鈕（最方便）

#### 設定步驟：

1. **開啟 Excel 檔案**（target.xlsx）

2. **開啟 VBA 編輯器**
   - 按 `Alt + F11` 開啟 VBA 編輯器
   - 或從功能區：`開發人員` → `Visual Basic`

3. **插入模組**
   - 在左側專案視窗中，對 `VBAProject (target.xlsx)` 按右鍵
   - 選擇 `插入` → `模組`

4. **貼上 VBA 程式碼**
   - 複製 `Excel_VBA_代碼.vba` 檔案中的所有內容
   - 貼到模組視窗中
   - 儲存（Ctrl + S）

5. **新增按鈕到工作表**
   - 關閉 VBA 編輯器回到 Excel
   - 點選 `開發人員` → `插入` → `按鈕（表單控制項）`
   - 在工作表上繪製按鈕
   - 在彈出的對話框中選擇巨集：`更新股票數據`
   - 按鈕名稱改為「更新股票數據」

6. **完成！**
   - 將 `股票數據處理器.exe` 放在與 Excel 檔案相同的資料夾
   - 點擊按鈕即可執行更新

---

## 📁 檔案結構

```
你的資料夾/
├── target.xlsx                 （你的 Excel 檔案）
├── 股票數據處理器.exe          （打包的執行檔）
├── 執行股票處理.bat           （批次檔，雙擊執行）
└── data/                      （選用）
    └── stock_info.json        （股票資訊快取）
```

---

## ⚠️ 注意事項

### 1. 防毒軟體警告
- 第一次執行可能會被防毒軟體攔截
- 請將執行檔加入信任清單

### 2. 檔案權限
- 確保 Excel 檔案沒有被其他程式開啟
- 執行時會自動儲存 Excel 檔案

### 3. 執行時間
- 處理時間取決於股票數量
- 建議處理期間不要關閉視窗

### 4. 網路連線
- 需要網路連線才能抓取股票資料
- 確保網路通暢

---

## 🔧 進階設定

### 自訂執行檔圖示
在 `stock_processor.spec` 中修改：
```python
icon='your_icon.ico'  # 指定你的 .ico 圖示檔
```

### 隱藏命令列視窗
在 `stock_processor.spec` 中修改：
```python
console=False  # 改為 False 會隱藏黑色視窗
```

### 加入其他資料檔案
在 `stock_processor.spec` 的 `datas` 中加入：
```python
datas=[
    ('data/stock_info.json', 'data'),
    ('config.ini', '.'),  # 加入其他檔案
],
```

---

## 🐛 疑難排解

### Q: 執行檔很大（超過 100MB）
A: 這是正常的，因為包含了所有 Python 函式庫

### Q: 執行時出現錯誤
A: 
1. 確認 Excel 檔案格式正確（第一個 sheet 有「代號」欄位）
2. 檢查是否有網路連線
3. 查看命令列視窗的錯誤訊息

### Q: VBA 巨集無法執行
A:
1. 確認已啟用巨集：`檔案` → `選項` → `信任中心` → `信任中心設定` → `巨集設定` → 啟用所有巨集
2. 確認 `股票數據處理器.exe` 與 Excel 檔案在同一資料夾

### Q: 在新電腦上執行失敗
A: 可能需要安裝 Visual C++ Redistributable
   - 下載連結：https://aka.ms/vs/17/release/vc_redist.x64.exe

---

## 📞 技術支援

如有問題，請檢查：
1. Excel 檔案格式是否正確
2. 執行檔是否在正確位置
3. 是否有網路連線
4. 防毒軟體是否阻擋

---

## 📝 更新日誌

### v1.0
- 初始版本
- 支援月營收、綜合損益表、EPS 數據
- 支援打包成獨立執行檔
- 提供 Excel VBA 整合
